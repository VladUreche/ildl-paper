\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{url}
\usepackage[usenames,dvipsnames]{color}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{listings}
% \usepackage[compact]{titlesec}
\usepackage{multirow}
\usepackage{color, colortbl}
\usepackage{fancyvrb}
\usepackage{shortvrb}
\usepackage{setspace}
\usepackage{flushend}
\usepackage{stfloats}
\usepackage{listings,xcolor,beramono}
\usepackage{tikz}
\usepackage{calc}
\usepackage[utf8x]{inputenc}
\usepackage{latexsym}
\usepackage[T1]{fontenc}
\setcounter{tocdepth}{3}

% Short verbatim
\DefineShortVerb{\|}
\fvset{fontsize=\small}

% Colors and table colors
\definecolor{Gray}{gray}{0.9}
\definecolor{LightGray}{gray}{0.4}
\newcolumntype{g}{>{\columncolor{Gray}}r}

% Lstlisting highlight
% http://tex.stackexchange.com/a/49309
\makeatletter
\newenvironment{btHighlight}[1][]
{\begingroup\tikzset{bt@Highlight@par/.style={#1}}\begin{lrbox}{\@tempboxa}}
{\end{lrbox}\bt@HL@box[bt@Highlight@par]{\@tempboxa}\endgroup}

\newcommand\btHL[1][]{%
  \begin{btHighlight}[#1]\bgroup\aftergroup\bt@HL@endenv%
}
\def\bt@HL@endenv{%
  \end{btHighlight}% % Don't worry about this error, the document
  \egroup            % compiles well despite its presence here!
}
\newcommand{\bt@HL@box}[2][]{%
  \tikz[#1]{%
    \pgfpathrectangle{\pgfpoint{1pt}{0pt}}{\pgfpoint{\wd #2}{\ht #2}}%
    \pgfusepath{use as bounding box}%
    \node[anchor=base west, fill=black!10,outer sep=0pt,inner xsep=1pt, inner ysep=0pt, rounded corners=1pt, minimum height=\ht\strutbox+1pt,#1]{\raisebox{1pt}{\strut}\strut\usebox{#2}};
  }%
}
\g@addto@macro\normalsize{%
  \setlength\abovedisplayskip{-0.5em}
  \setlength\belowdisplayskip{1em}
  \setlength\abovedisplayshortskip{0.25em}
  \setlength\belowdisplayshortskip{0.25em}
}
\makeatother

% Define the Scala language
\lstdefinelanguage{scala}{
  morekeywords={abstract,case,catch,class,def,%
    do,else,extends,false,final,finally,%
    for,if,implicit,import,match,mixin,%
    new,null,object,override,package,%
    private,protected,requires,return,sealed,%
    super,this,throw,trait,true,try,%
    type,val,var,while,with,yield},
  otherkeywords={=>,<-,<\%,<:,>:,\#,@},
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[n]{/*}{*/},
  morestring=[b]",
  morestring=[b]',
  morestring=[b]""",
  moredelim=**[is][\btHL]{`}{`},
}

% Default settings for code listings
\definecolor{ggray}{gray}{0.5}
\renewcommand{\ttdefault}{pcr}
\lstset{frame=tb,
  language=scala,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\scriptsize \ttfamily},
  numbers=left,
  numberstyle=\tiny\color{gray},
  keywordstyle=\bfseries,
  commentstyle=\em\color{ggray},
  stringstyle=\em,
  frame=single,
  breaklines=true,
  breakatwhitespace=true
  tabsize=2
}

%% Line numbers inside frame:
%% http://tex.stackexchange.com/questions/30504/how-can-i-properly-align-the-line-numbers-of-a-source-code-listing-with-the-marg
\makeatletter
\newlength{\linenumwidth} \setlength{\linenumwidth}{1.5em}% Redefine as required
\newlength{\numwidth}%
\setlength{\numwidth}{\widthof{\normalfont{\lst@numberstyle{99}}}}% Up to 2-digit (99) line numbers
\def\lst@PlaceNumber{%
  \makebox[\linenumwidth][l]{%
    \makebox[\numwidth][r]{\normalfont\lst@numberstyle{\thelstnumber}}%
  }%
}
\makeatother

%%% How to prevent lstlisting from splitting code between pages?
%%% http://tex.stackexchange.com/questions/10141/how-to-prevent-lstlisting-from-splitting-code-between-pages
\lstnewenvironment{lstlisting-nobreak}[1][]%
{
  \vspace{0.1em}
  \noindent
  \minipage{\linewidth}
}
{
  \endminipage
  \vspace{-0.3em}
}

% Review tools
\newcommand{\topic}[1]{{\bf \color{Bittersweet}#1}}
\newcommand{\yannis}[1] {{\color{Red}        {\bf \framebox{Yannis}\;#1}}\;}
\newcommand{\vlad}[1]   {{\color{BurntOrange}{\bf \framebox{Vlad}\;#1}}\;}
\newcommand{\aggelos}[1]{{\color{Blue}       {\bf \framebox{Aggelos}\;#1}}\;}
\newcommand{\dima}[1]   {{\color{Green}      {\bf \framebox{Dima}\;#1}}\;}

% Shortcuts
\newcommand{\textem}[1]{{\em#1}}
\newcommand{\newterm}[1]{{\em #1}}

% Separators and paper-specific definitions
\newcommand{\inject}[0]{\textsc{inject}}
\newcommand{\bridge}[0]{\textsc{bridge}}
\newcommand{\coerce}[0]{\textsc{coerce}}
\newcommand{\commit}[0]{\textsc{commit}}
\newcommand{\Inject}[0]{\textsc{Inject}}
\newcommand{\Bridge}[0]{\textsc{Bridge}}
\newcommand{\Coerce}[0]{\textsc{Coerce}}
\newcommand{\Commit}[0]{\textsc{Commit}}
\newcommand{\inv}[1]{{\color{White}#1}}

\newcommand{\keywords}[1]{\par\addvspace\baselineskip
\noindent\keywordname\enspace\ignorespaces#1}

\renewcommand{\subsubsection}[1]{\vspace{0.5em}\noindent\textbf{#1}}
